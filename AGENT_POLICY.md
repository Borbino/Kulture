# Agent 권한·검토·승인 정책 (초안)

목적

- 이 문서는 Agent(자동화 도구) 및 AI가 수행하는 작업에 대한 권한 수준, 승인 흐름, 안전장치, 감사 요구사항을 정의합니다.
- CEO(프로젝트 소유자)를 최종 승인자로 지정하며, 자동 PR/커밋 허용 범위와 검증 요건을 명시합니다.

적용 범위

- `Agent`, `Ask`, `Edit`, `Plan`으로 분류되는 자동화/대화형 작업에 모두 적용합니다.
- 모든 자동 변경은 이 정책의 규칙을 따라야 하며, 예외는 CEO의 서면(또는 기록된) 승인이 있어야 합니다.

역할과 책임

- CEO(승인자): 권한 부여 및 주요 변경(정책·인프라·보안 관련)의 최종 승인.
- Agent(자동화): 지정된 권한 범위 내에서 작업 수행. 변경 시 ReviseLog 항목을 반드시 작성.
- 개발자/리뷰어: 변경 검토, 테스트 실행, 보안 점검 수행.
- 시스템(자동화 도구): CI 실행·보안 스캔 수행 및 결과 보고.

권한 레벨(정의)

1. Read-Only
   - 코드·문서 조회만 가능. 기본 권한으로 모든 Agent는 이 수준에서 시작.
2. Suggest (제안)
   - 파일 수정 제안(patch/PR) 생성 가능. 직접 커밋하지 않고 PR을 생성.
3. Commit (제한적 자동 커밋)
   - 자동으로 커밋 및(옵션) 자동 병합 가능. 다만 아래의 안전 체크를 모두 통과해야 함.
4. Admin
   - 저장소 설정 변경 등 고위험 작업. 매우 제한적으로 부여하며 CEO의 사전 승인 필요.

기본 정책

- 기본 원칙: Agent는 초기에는 `Read-Only` 권한만 부여합니다. 이후 단계적 신뢰 검증을 통해 `Suggest` 또는 `Commit` 권한을 부여할 수 있습니다.
- 승인은 CEO(사용자)로 지정됩니다. (요청자 지시)
- 사용자가 "자동으로 PR 생성/커밋 허용"을 승인했으므로, 조건을 만족할 때만 자동 커밋/자동 병합을 허용합니다(아래 자동 병합 규칙 참조).

자동 커밋/자동 병합 허용 조건(필수 체크)

- ReviseLog 항목이 존재하고, 커밋 메시지 또는 PR 본문에 ReviseLog ID를 포함해야 합니다.
- 모든 CI 작업(lint, unit tests, security scan)이 성공적으로 통과해야 합니다.
- 변경이 민감한 파일(예: `/lib`, `/auth`, 인프라 설정 파일, `secrets` 관련 파일)을 건드리지 않아야 합니다.
- 변경 범위 임계값을 초과하지 않아야 함(아래 정의).
- 의심스러운 시큐리티 소견(Security scan)이 있으면 자동 병합 불가.

변경 범위 임계값(자동 병합 한계)

- 자동 병합이 가능한 변경은 다음 조건을 모두 만족해야 합니다:
  - 수정 파일 수 <= 5
  - 총 변경 라인 수(추가+삭제) <= 200
  - 변경 대상 경로에 `/lib`, `/auth`, CI workflow, 또는 `*.key`, `*.pem` 파일이 포함되지 않음
- 위 임계값을 초과하면 Agent는 PR을 생성하되 CEO의 수동 승인(리뷰+머지)이 필요합니다.

ReviseLog 규칙(필수)

- 모든 변경은 `ReviseLog.md`에 항목을 추가해야 합니다. 항목에는 ReviseLog ID(RL-YYYYMMDD-NN), 날짜, 작성자, 변경 유형, 변경 대상, 요약, 상세 설명, 되돌리기 방법, 관련 PR/이슈를 포함해야 합니다.
- PR/커밋 메시지에는 반드시 ReviseLog ID를 포함하세요.

커밋·PR 메시지 규칙(형식)

- 커밋 메시지(예): `[RL-20251119-02] 문서: README ReviseLog 규칙 추가`
- PR 제목(예): `RL-20251119-02: 문서 변경 - ReviseLog 규칙 추가`
- PR 본문에는 ReviseLog 상세 설명(템플릿)을 붙여넣고 관련 이슈/스크린샷을 첨부하세요.

감사·모니터링

- 모든 자동화 작업(Agent 실행)은 감사 로그에 기록되어야 합니다: 누가(Agent 이름/ID), 언제, 어떤 명령을 실행했는지, 변경된 파일 목록, ReviseLog ID.
- 로그는 프로젝트 저장소에 저장되며(예: `logs/agent-audit.log` 또는 외부 로깅 시스템), 최소 90일간 보관합니다.

권한 부여 및 철회 절차

- 권한 부여 요청: 권한을 부여하려면 ReviseLog 항목과 간단한 권한 요청서를 제출(예: PR 또는 이슈)하고 CEO가 승인해야 합니다.
- 권한 철회: CEO는 언제든지 Agent의 권한을 철회할 수 있으며, 철회 시 즉시 해당 Agent의 모든 자동 작업을 중단해야 합니다.

보안 및 비밀(Secrets) 정책

- 절대 금지: 시크릿·API 키·개인정보를 코드나 문서에 직접 커밋하지 않습니다.
- Agent가 시크릿을 필요로 하는 작업은 환경변수·시크릿 매니저(예: GitHub Secrets)를 사용하고, 절대 ReviseLog나 PR 본문에 평문으로 기록하지 않습니다.

비상 롤백 절차

1. CI 실패 또는 심각한 오류 발생 시 자동으로 롤백 스크립트(예: `revert.sh` 또는 Git revert)를 실행할 수 있도록 권장합니다(옵션적 자동화).
2. 즉시 CEO와 관련 담당자에게 알림(이메일/채널) 발송.
3. ReviseLog에 롤백 이유 및 조치 내역 기록.

Agent 지시(샘플 템플릿)

- 목적: 변경 의도와 범위를 명확히 전달하기 위한 템플릿.

```
[Agent Command Template]
- 목적: (예: README에 ReviseLog 규칙 추가)
- 범위: (예: `README.md` 1파일)
- 출력 형식: Patch (apply_patch 형식) + ReviseLog 항목 초안
- 제한: 변경 파일 수 <= 2, 변경 라인 <= 50
- 추가 요구: PR 생성 후 CEO 자동 병합 허용(조건 충족 시)
```

샘플 워크플로우(요약)

1. Agent가 변경 제안 생성(패치) → ReviseLog 항목 초안 작성
2. PR 생성(Agent 또는 자동화) → PR 본문에 ReviseLog ID 포함
3. CI 실행(자동) → 모든 체크 통과 시 자동 병합(임계값 이하 변경의 경우)
4. 자동 병합 시 ReviseLog 항목 최종 업데이트(작성자/시간 기록)

검토 및 승인

- 이 문서는 초안입니다. CEO의 검토 및 승인 후 공식 정책으로 확정합니다.
- 수정 요청이 있으면 항목별로 반영하겠습니다.

---

작성자: 시스템(초안)
생성일: 2025-11-19

다음 권장 작업: 이 초안을 바탕으로 `PR_TEMPLATE.md`와 `gitHub Actions`에서 ReviseLog 및 CI 조건을 체크하는 워크플로우 초안을 만들겠습니다. 진행해도 될까요?
